{"ast":null,"code":"import _objectSpread from\"C:/Users/yashk/TurfArena/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// Frontend: Updated TurfDetails.js with Mock Payment\nimport React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{MapPin,Star,Calendar,Clock}from'lucide-react';import{getTurf,createBooking,createPaymentOrder,verifyPayment}from'../utils/api';import{useAuth}from'../context/AuthContext';import MockPaymentModal from'../components/MockPaymentModal';import{jsx as _jsx}from\"react/jsx-runtime\";const TurfDetails=()=>{var _turf$availability$fi;const{id}=useParams();const{user}=useAuth();const navigate=useNavigate();const[turf,setTurf]=useState(null);const[loading,setLoading]=useState(true);const[selectedDate,setSelectedDate]=useState('');const[selectedSlots,setSelectedSlots]=useState([]);const[bookingLoading,setBookingLoading]=useState(false);const[showPaymentModal,setShowPaymentModal]=useState(false);const[currentOrder,setCurrentOrder]=useState(null);const[currentBookingData,setCurrentBookingData]=useState(null);useEffect(()=>{fetchTurfDetails();},[id]);const fetchTurfDetails=async()=>{try{const res=await getTurf(id);setTurf(res.data.turf);}catch(error){console.error('Error fetching turf:',error);}finally{setLoading(false);}};const handleSlotSelection=slot=>{if(slot.isBooked)return;const slotKey=\"\".concat(slot.startTime,\"-\").concat(slot.endTime);if(selectedSlots.includes(slotKey)){setSelectedSlots(selectedSlots.filter(s=>s!==slotKey));}else{setSelectedSlots([...selectedSlots,slotKey]);}};const calculateTotalAmount=()=>{return selectedSlots.length*turf.pricing.basePrice;};const handleBooking=async()=>{if(!user){navigate('/login');return;}if(selectedSlots.length===0){alert('Please select at least one slot');return;}try{setBookingLoading(true);// Parse slots\nconst slots=selectedSlots.map(slotKey=>{const[startTime,endTime]=slotKey.split('-');return{startTime,endTime};});const totalAmount=calculateTotalAmount();// Store booking data for later\nsetCurrentBookingData({turf:id,bookingDate:selectedDate,slots,totalAmount});// Create Mock payment order\nconst orderRes=await createPaymentOrder({amount:totalAmount,paymentType:'booking'});const{order,paymentId}=orderRes.data;setCurrentOrder(_objectSpread(_objectSpread({},order),{},{paymentId}));// Show mock payment modal\nsetShowPaymentModal(true);}catch(error){console.error('Booking error:',error);alert('Booking failed. Please try again.');}finally{setBookingLoading(false);}};const handlePaymentSuccess=async paymentData=>{try{// Verify payment\nawait verifyPayment({razorpayOrderId:paymentData.razorpayOrderId,razorpayPaymentId:paymentData.razorpayPaymentId,razorpaySignature:paymentData.razorpaySignature,paymentId:currentOrder.paymentId});// Create booking\nawait createBooking(_objectSpread(_objectSpread({},currentBookingData),{},{paymentId:currentOrder.paymentId}));setShowPaymentModal(false);alert('Booking successful!');navigate('/bookings');}catch(error){console.error('Payment verification failed:',error);alert('Payment verification failed');}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-green-500\"})});}if(!turf){return/*#__PURE__*/_jsx(\"div\",{className:\"container mx-auto px-4 py-8\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Turf not found\"})});}const availableSlots=((_turf$availability$fi=turf.availability.find(a=>a.date===selectedDate))===null||_turf$availability$fi===void 0?void 0:_turf$availability$fi.slots)||[];return/*#__PURE__*/_jsx(\"div\",{className:\"container mx-auto px-4 py-8\",children:/*#__PURE__*/_jsx(MockPaymentModal,{isOpen:showPaymentModal,onClose:()=>setShowPaymentModal(false),amount:calculateTotalAmount(),orderId:currentOrder===null||currentOrder===void 0?void 0:currentOrder.id,onSuccess:handlePaymentSuccess})});};export default TurfDetails;","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","MapPin","Star","Calendar","Clock","getTurf","createBooking","createPaymentOrder","verifyPayment","useAuth","MockPaymentModal","jsx","_jsx","TurfDetails","_turf$availability$fi","id","user","navigate","turf","setTurf","loading","setLoading","selectedDate","setSelectedDate","selectedSlots","setSelectedSlots","bookingLoading","setBookingLoading","showPaymentModal","setShowPaymentModal","currentOrder","setCurrentOrder","currentBookingData","setCurrentBookingData","fetchTurfDetails","res","data","error","console","handleSlotSelection","slot","isBooked","slotKey","concat","startTime","endTime","includes","filter","s","calculateTotalAmount","length","pricing","basePrice","handleBooking","alert","slots","map","split","totalAmount","bookingDate","orderRes","amount","paymentType","order","paymentId","_objectSpread","handlePaymentSuccess","paymentData","razorpayOrderId","razorpayPaymentId","razorpaySignature","className","children","availableSlots","availability","find","a","date","isOpen","onClose","orderId","onSuccess"],"sources":["C:/Users/yashk/TurfArena/frontend/src/pages/TurfDetails.js"],"sourcesContent":["// Frontend: Updated TurfDetails.js with Mock Payment\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { MapPin, Star, Calendar, Clock } from 'lucide-react';\r\nimport { getTurf, createBooking, createPaymentOrder, verifyPayment } from '../utils/api';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport MockPaymentModal from '../components/MockPaymentModal';\r\n\r\nconst TurfDetails = () => {\r\n  const { id } = useParams();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [turf, setTurf] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedDate, setSelectedDate] = useState('');\r\n  const [selectedSlots, setSelectedSlots] = useState([]);\r\n  const [bookingLoading, setBookingLoading] = useState(false);\r\n  const [showPaymentModal, setShowPaymentModal] = useState(false);\r\n  const [currentOrder, setCurrentOrder] = useState(null);\r\n  const [currentBookingData, setCurrentBookingData] = useState(null);\r\n\r\n  useEffect(() => {\r\n    fetchTurfDetails();\r\n  }, [id]);\r\n\r\n  const fetchTurfDetails = async () => {\r\n    try {\r\n      const res = await getTurf(id);\r\n      setTurf(res.data.turf);\r\n    } catch (error) {\r\n      console.error('Error fetching turf:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSlotSelection = (slot) => {\r\n    if (slot.isBooked) return;\r\n    \r\n    const slotKey = `${slot.startTime}-${slot.endTime}`;\r\n    if (selectedSlots.includes(slotKey)) {\r\n      setSelectedSlots(selectedSlots.filter(s => s !== slotKey));\r\n    } else {\r\n      setSelectedSlots([...selectedSlots, slotKey]);\r\n    }\r\n  };\r\n\r\n  const calculateTotalAmount = () => {\r\n    return selectedSlots.length * turf.pricing.basePrice;\r\n  };\r\n\r\n  const handleBooking = async () => {\r\n    if (!user) {\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    if (selectedSlots.length === 0) {\r\n      alert('Please select at least one slot');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setBookingLoading(true);\r\n\r\n      // Parse slots\r\n      const slots = selectedSlots.map(slotKey => {\r\n        const [startTime, endTime] = slotKey.split('-');\r\n        return { startTime, endTime };\r\n      });\r\n\r\n      const totalAmount = calculateTotalAmount();\r\n\r\n      // Store booking data for later\r\n      setCurrentBookingData({\r\n        turf: id,\r\n        bookingDate: selectedDate,\r\n        slots,\r\n        totalAmount\r\n      });\r\n\r\n      // Create Mock payment order\r\n      const orderRes = await createPaymentOrder({\r\n        amount: totalAmount,\r\n        paymentType: 'booking'\r\n      });\r\n\r\n      const { order, paymentId } = orderRes.data;\r\n      setCurrentOrder({ ...order, paymentId });\r\n      \r\n      // Show mock payment modal\r\n      setShowPaymentModal(true);\r\n      \r\n    } catch (error) {\r\n      console.error('Booking error:', error);\r\n      alert('Booking failed. Please try again.');\r\n    } finally {\r\n      setBookingLoading(false);\r\n    }\r\n  };\r\n\r\n  const handlePaymentSuccess = async (paymentData) => {\r\n    try {\r\n      // Verify payment\r\n      await verifyPayment({\r\n        razorpayOrderId: paymentData.razorpayOrderId,\r\n        razorpayPaymentId: paymentData.razorpayPaymentId,\r\n        razorpaySignature: paymentData.razorpaySignature,\r\n        paymentId: currentOrder.paymentId\r\n      });\r\n\r\n      // Create booking\r\n      await createBooking({\r\n        ...currentBookingData,\r\n        paymentId: currentOrder.paymentId\r\n      });\r\n\r\n      setShowPaymentModal(false);\r\n      alert('Booking successful!');\r\n      navigate('/bookings');\r\n    } catch (error) {\r\n      console.error('Payment verification failed:', error);\r\n      alert('Payment verification failed');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-green-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!turf) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <p>Turf not found</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const availableSlots = turf.availability.find(\r\n    a => a.date === selectedDate\r\n  )?.slots || [];\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-8\">\r\n      {/* ... rest of the TurfDetails component remains the same ... */}\r\n      \r\n      {/* Mock Payment Modal */}\r\n      <MockPaymentModal\r\n        isOpen={showPaymentModal}\r\n        onClose={() => setShowPaymentModal(false)}\r\n        amount={calculateTotalAmount()}\r\n        orderId={currentOrder?.id}\r\n        onSuccess={handlePaymentSuccess}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TurfDetails;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}